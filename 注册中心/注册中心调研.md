# 功能对比

| Feature              | euerka                       | Consul                 | zookeeper             | etcd              |
| :------------------- | :--------------------------- | :--------------------- | :-------------------- | :---------------- |
| 服务健康检查         | 可配支持                     | 服务状态，内存，硬盘等 | (弱)长连接，keepalive | 连接心跳          |
| 多数据中心           | —                            | 支持                   | —                     | —                 |
| kv 存储服务          | —                            | 支持                   | 支持                  | 支持              |
| 负载均衡策略         | Ribbon                       | Fabio                  | —                     |                   |
| 一致性               | —                            | raft                   | paxos                 | raft              |
| cap                  | ap                           | cp                     | cp                    | cp                |
| 使用接口(多语言能力) | http（sidecar）              | 支持 http 和 dns       | 客户端                | http/grpc         |
| watch 支持           | 支持 long polling/大部分增量 | 全量/支持long polling  | 支持                  | 支持 long polling |
| 自身监控             | metrics                      | metrics                | —                     | metrics           |
| 安全                 | —                            | acl /https             | acl                   | https 支持（弱）  |
| spring cloud 集成    | 已支持                       | 已支持                 | 已支持                | 已支持            |

# 健康检查

Zookeeper、Eureka都实现了一种TTL机制（Time To Live），如果客户端在一定的时间内没有向注册中心发送心跳后，则会将这个客户端摘除；

Consul也支持TTL方式，但是提供了更加全面的健康检查方式；

健康检查的方式分为**客户端健康检查**和**服务端健康检查**，客户端健康检查和服务端健康检查有一些不同的关注点；

## 客户端健康检查

客户端健康检查主要关注**客户端上报心跳的方式**、**服务端摘除不健康客户端的机制**；



## 服务端健康检查

服务端健康检查则关注探测客户端的方式、灵敏度以及设置客户端健康状态的机制；



## 两种方式对比

| 方式       | 实现                                                         | 实例剔除                                                     |
| :--------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 客户端探测 | 从实现复杂性上来讲，服务端探测肯定会更加复杂，因为服务端根据注册服务配置的健康检查方式，去执行响应的接口，判断响应的返回结果，并做好重试机制和线程池管理。 | 服务端健康检查**无法摘除**不健康实例，这意味只要注册过的服务实例，只要不调用接口主动注销，这些服务实例都需要去维护健康检查的探测任务； |
| 服务端探测 | 客户端探测从实现上只需要等待心跳，然后刷新TTL；              | 可以摘除不健康实例，减轻服务端的压力。                       |



# 负载均衡

负载均衡严格的来讲，并不算传统注册中心的功能。一般来讲服务发现的完整流程应该是先从注册中心获取服务的实例列表，然后根据自身的需求，来选择其中的部分实例或按照一定的流量分配机制来访问不同的服务提供者，因此注册中心本身不限定服务消费者的访问策略；

Eureka、Zookeeper和Consul本身没有去实现可配置及可扩展的负载均衡策略机制，**Eureka**的负载均衡是由**Ribbon**来完成，**Consul**则是利用**Fabio**做负载均衡；



# 参考

1. [主流微服务注册中心浅析和对比](
